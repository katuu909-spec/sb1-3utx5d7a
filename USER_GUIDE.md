# 風量測定アプリ 取扱説明書

> 画面イメージは `docs/images` 配下に保存してください。以下の `![...]` を差し替えてお使いください。

## 1. 概要
- 空調機器の風量測定を行い、測定値と画像を Supabase に保存するシングルページアプリ。
- 認証はメール＆パスワード。初回ログイン後、メールの確認リンクを踏むと有効化されます。

## 2. 必要なもの
- ブラウザ（PC/スマホ）
- アカウント（メールアドレス＋パスワード）

## 3. ログインとメール確認
1. ログイン画面でメール・パスワードを入力し「ログイン」  
   ![ログイン画面](docs/images/login.png)
2. 初回ログイン時は登録メールに「確認メール」が届くので、リンクをクリック  
   - リンクを踏むと Supabase 側で `Confirmed at` がセットされ、ログイン可能になります。
3. パスワードを忘れた場合は「パスワードをお忘れの方」からリセットメールを送信。

## 4. 案件の作成
1. ホームの「新規測定」ボタンを押す  
   ![ホーム](docs/images/home.png)
2. 製造番号・機種型式・機種番号を入力して「次へ」  
   ![新規案件](docs/images/new_project.png)
3. 自動的に案件が作成され、測定箇所一覧へ遷移します。

## 5. 測定箇所の追加
### グループ指定で一括作成
1. 「新規追加」→ グループ名を入力（例: 吸込／吹出）  
   ![グループ名](docs/images/group_name.png)
2. 同グループ内の測定箇所数を指定  
   ![箇所数](docs/images/location_count.png)
3. 各箇所の形状（四角/円）、寸法、測定点数を入力して保存。指定数に達すると一覧へ戻ります。  
   ![詳細入力](docs/images/location_detail.png)

### 単発追加（ショートカット）
- 「測定箇所を追加」からプリセット名 or カスタム名で1件だけ登録できます。  
  ![単発追加](docs/images/new_location.png)

## 6. 撮影と測定値の入力
1. 測定箇所カードを選択 → 「撮影」画面へ  
   ![撮影画面](docs/images/shooting.png)
2. カメラで撮影（または画像選択）→ 「次へ」
3. AVE風速を入力して「保存」。画像は Supabase Storage `measurement-images` に保存され、URLが測定値と紐付く。
4. 測定点数に達すると自動でステータスが「確定済み」となり、結果画面へ。

## 7. 集計ページ（案件内）
1. ホームの案件カードで「集計」を押す  
   ![集計ボタン](docs/images/home_summary.png)
2. グループ（例: 吸込）ごとに風量合計を表示。  
   - 各測定箇所カード: 形状・寸法・測定点数・風量  
   - 下部テーブル: 測定点別の AVE風速 / 風量 / 画像リンク  
   ![集計ページ](docs/images/summary.png)
3. 風量の表示は小数点2位で丸め（合計も2位四捨五入）。

## 8. 測定箇所一覧で見られる情報
- 形状、寸法、測定点数、風量（概算）を表示。完了済みは「確定済み」と表示され、結果画面へ遷移します。

## 9. トラブルシュート
- ログインできない / メールが見つからない  
  - メールアドレスを正しい綴りで入力（大文字小文字・前後スペースは自動正規化済み）。  
  - Supabase Auth の `Confirmed at` が空の場合、確認メールのリンクを踏んでください。  
  - 別デバイスでメールを開く場合は、リンク先が外部から開ける URL（例: Vercel ドメイン）になっていることを確認。
- 画像が表示されない  
  - Storage バケット `measurement-images` のポリシーが認証ユーザーの参照を許可しているか確認。
- 風量が 0 になる  
  - 寸法（円なら直径、四角なら縦横）が未入力でないか確認。

## 10. 運用のヒント
- 変更は Git コミット → Vercel プッシュで自動デプロイ。  
- 環境変数（Vercel / `.env.local`）  
  - `VITE_SUPABASE_URL`  
  - `VITE_SUPABASE_ANON_KEY`


